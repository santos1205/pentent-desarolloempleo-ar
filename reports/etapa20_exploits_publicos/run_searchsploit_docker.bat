@echo off
REM Etapa 20: Buscar Exploits Públicos
REM Script para executar searchsploit via Docker no Windows

cd /d "%~dp0"

echo ==========================================
echo ETAPA 20: BUSCAR EXPLOITS PÚBLICOS (DOCKER)
echo ==========================================
echo.

REM Verificar se Docker está instalado
docker --version >nul 2>&1
if errorlevel 1 (
    echo [!] Docker não encontrado. Instale o Docker Desktop para Windows:
    echo     https://www.docker.com/products/docker-desktop
    exit /b 1
)

REM Verificar se Docker está rodando
docker info >nul 2>&1
if errorlevel 1 (
    echo [!] Docker não está rodando. Inicie o Docker Desktop.
    exit /b 1
)

echo [+] Docker encontrado e rodando
echo.

REM Usar imagem do Exploit-DB via Docker
set DOCKER_IMAGE=reedcrif/searchsploit:latest

REM Verificar se a imagem existe, se não, fazer pull
docker image inspect %DOCKER_IMAGE% >nul 2>&1
if errorlevel 1 (
    echo [+] Baixando imagem do Exploit-DB...
    docker pull %DOCKER_IMAGE%
)

echo [+] Teste 1: searchsploit - WordPress Core 6.8.3
echo --------------------------------------------
docker run --rm %DOCKER_IMAGE% searchsploit wordpress 6.8 > searchsploit_wordpress.txt 2>&1
type searchsploit_wordpress.txt
echo.

echo [+] Teste 2: searchsploit - Elementor
echo --------------------------------------------
docker run --rm %DOCKER_IMAGE% searchsploit elementor > searchsploit_elementor.txt 2>&1
type searchsploit_elementor.txt
echo.

echo [+] Teste 3: searchsploit - Elementor Pro
echo --------------------------------------------
docker run --rm %DOCKER_IMAGE% searchsploit "elementor pro" > searchsploit_elementor_pro.txt 2>&1
type searchsploit_elementor_pro.txt
echo.

echo [+] Teste 4: searchsploit - Plugins WordPress
echo --------------------------------------------
docker run --rm %DOCKER_IMAGE% searchsploit "ivory search" > searchsploit_ivory_search.txt 2>&1
type searchsploit_ivory_search.txt
docker run --rm %DOCKER_IMAGE% searchsploit "spotlight social" > searchsploit_spotlight.txt 2>&1
type searchsploit_spotlight.txt
echo.

echo [+] Teste 5: searchsploit - Astra Theme
echo --------------------------------------------
docker run --rm %DOCKER_IMAGE% searchsploit astra > searchsploit_astra.txt 2>&1
type searchsploit_astra.txt
echo.

echo [+] Teste 6: searchsploit - jQuery Migrate
echo --------------------------------------------
docker run --rm %DOCKER_IMAGE% searchsploit "jquery migrate" > searchsploit_jquery_migrate.txt 2>&1
type searchsploit_jquery_migrate.txt
echo.

echo [+] Teste 7: searchsploit - Addons for Elementor
echo --------------------------------------------
docker run --rm %DOCKER_IMAGE% searchsploit "addons for elementor" > searchsploit_addons_elementor.txt 2>&1
type searchsploit_addons_elementor.txt
echo.

echo ==========================================
echo TESTES CONCLUÍDOS
echo ==========================================
echo Resultados salvos em: %CD%
echo.
echo Arquivos gerados:
dir /b searchsploit_*.txt 2>nul
